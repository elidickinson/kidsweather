<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <style>
            html, body {
                height: 2560px;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }

            .weather-container {
                display: flex;
                flex-direction: column;
                margin: 0;
                padding: 20px 50px;
                height: 2560px;
                box-sizing: border-box;
                font-family:
                    'Inter',
                    -apple-system,
                    BlinkMacSystemFont,
                    'Segoe UI',
                    Roboto,
                    Helvetica,
                    Arial,
                    sans-serif,
                    'Apple Color Emoji',
                    'Segoe UI Emoji';
                font-size: 3.8rem;
            }

            #cwg-content {
                flex: 1;
                margin-top: 3rem;
                font-size: 2.2rem;
                font-family: Georgia, 'Times New Roman', serif;
                line-height: 1.2;
                column-count: 3;
                column-gap: 2rem;
                column-fill: auto;
                overflow: hidden;
            }

            #cwg-content h1 {
                font-size: 2.8rem;
                text-align: center;
                margin-bottom: 1rem;
                font-family: 'Times New Roman', serif;
                font-weight: bold;
            }

            #cwg-content h2 {
                font-size: 2.4rem;
                border-bottom: 1px solid #000;
                padding-bottom: 0.5rem;
            }

            #cwg-content h3 {
                font-size: 2.0rem;
                font-weight: bold;
            }

            .weather-header {
                margin-bottom: 1rem;
            }

            .desc {
                font-size: 4.8rem;
                font-weight: bolder;
            }

            .icon-header {
                margin: 5px auto;
                text-align: center;
            }

            .icon-layout {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .temp-column {
                display: flex;
                flex-direction: column;
                justify-content: center;
                min-width: 120px;
                width: 35%;
            }

            .icon-column {
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .icon {
                width: 250px;
                height: 250px;
                object-fit: contain;
            }

            .big-temp {
                font-weight: bold;
                font-size: 4.2rem;
            }

            .date {
                font-size: 3.0rem;
                text-align: center;
                color: #333;
            }

            .alerts {
                margin-top: 1rem;
                padding: 0.75rem;
                background-color: #fff3cd;
                border: 1px solid #ffecb5;
                border-radius: 4px;
                color: #664d03;
            }

            .forecast {
                margin: 2rem 0;
            }

            .forecast-grid {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 1.5rem;
            }

            .forecast-box {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 1rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }

            .forecast-day {
                font-weight: bold;
                font-size: 3.1rem;
                margin-bottom: 0.2rem;
            }


            .forecast-temps {
                display: flex;
                gap: 1rem;
            }

            .forecast-box-desc {
                font-weight: bold;
                font-size: 3.2rem;
            }

            #dogs {
                display: flex;
                flex-wrap: nowrap;
                gap: 15px;
                margin: 20px 0;
                overflow-x: auto;
                justify-content: flex-start;
                align-items: center;
            }

            #dogs img {
                height: 270px;
                width: auto;
                object-fit: cover;
                flex-shrink: 0;
            }
        </style>
    </head>
    <body>
        <div class="weather-container">
            <div class="weather-header">
                <div class="date">
                    {{ weather['last_updated'] }}
                </div>
                <div class="icon-header">
                    <div class="icon-layout">
                        <div class="temp-column">
                            <span class="big-temp">{{ weather['temperature'] }}°F</span>
                            {% if 'feels_like' in weather and (weather['temperature'] - weather['feels_like'])|abs >= 10 %}
                                (feels like {{ weather['feels_like'] }}°F)
                            {% else %}
                                <span style="font-size: 3.5rem; word-wrap: break-word; max-width: 100%;">{{ weather['conditions'] }}</span>
                            {% endif %}
                        </div>
                        <div class="icon-column">
                            <img src="{{ weather['icon_url'] }}" class="icon" />
                        </div>
                        <div class="temp-column">
                            <span>High ↑ {{ weather['high_temp'] }}°F</span>
                            <span>Low&nbsp; ↓ {{ weather['low_temp'] }}°F</span>
                        </div>
                    </div>
                </div>
                {% if weather['alerts'] %}
                <div class="alerts">
                    <strong>Alerts:</strong> {{ weather['alerts'] | join('; ') }}
                </div>
                {% endif %}
                <p class="desc">{{ weather['description'] }}</p>

                <div class="forecast">
                    <div class="forecast-grid">
                        {% for day, forecast in weather['daily_forecasts_llm'].items() %}
                        {% if loop.index <= 2 %}
                        <div class="forecast-box">
                            <div class="forecast-day">
                                {{ day }}
                                {% set day_name = day %}
                                {% set day_index = loop.index0 %}
                                <span>↑{{ weather['daily_forecast_raw'][day_index]['high'] }}°F</span>
                                <span>↓{{ weather['daily_forecast_raw'][day_index]['low'] }}°F</span>
                            </div>
                            <div class="forecast-box-desc">
                                {% set icon = weather['daily_forecast_raw'][day_index]['icon'] if day_index < weather['daily_forecast_raw']|length else '' %}
                                {% if icon %}
                                <img src="https://openweathermap.org/img/wn/{{ icon }}@4x.png"
                                     style="width: 125px; height: 125px; vertical-align: middle; filter: brightness(0.7);">
                                {% endif %}

                                {{ forecast }}

                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div id="dogs">
                <p>Loading dog images...</p>
            </div>
            <!-- CWG content section -->
            <div id="cwg-content">
                <p>Loading content...</p>
            </div>
        </div>

        <script>
            // Function to load content dynamically from the CWG API
            async function loadCwgContent() {
                const cwgContentDiv = document.getElementById('cwg-content');

                try {
                    const response = await fetch('https://cwg.eli.pw/api/cwg.html?use_existing_llm_output=true');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const htmlContent = await response.text();
                    cwgContentDiv.innerHTML = htmlContent;
                } catch (error) {
                    console.error('Error loading CWG content:', error);
                    cwgContentDiv.innerHTML = '<p>Failed to load additional content.</p>';
                }
            }

            // Function to load dog images
            async function loadDogImages() {
                const dogsDiv = document.getElementById('dogs');
                dogsDiv.innerHTML = ''; // Clear loading message

                // Get the page width to estimate how many dogs we can fit
                const pageWidth = window.innerWidth;
                const estimatedDogWidth = 250; // rough estimate of dog image width
                const numDogs = Math.floor(pageWidth / estimatedDogWidth);

                try {
                    const dogPromises = [];
                    // Load dog images to fill the row
                    for (let i = 0; i < numDogs; i++) {
                        dogPromises.push(fetch('https://dog.ceo/api/breeds/image/random'));
                    }

                    const responses = await Promise.all(dogPromises);
                    const imageData = await Promise.all(responses.map(response => response.json()));

                    imageData.forEach(data => {
                        if (data.status === 'success') {
                            const img = document.createElement('img');
                            img.src = data.message;
                            img.alt = 'Cute dog picture';
                            img.loading = 'lazy';
                            dogsDiv.appendChild(img);
                        }
                    });
                } catch (error) {
                    console.error('Error loading dog images:', error);
                    dogsDiv.innerHTML = '<p>Failed to load dog images.</p>';
                }
            }

            // Load the content when the page loads
            document.addEventListener('DOMContentLoaded', () => {
                loadCwgContent();
                loadDogImages();
            });
        </script>
    </body>
</html>
